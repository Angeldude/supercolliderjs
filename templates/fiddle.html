<!DOCTYPE html>
<html lang="en">

<head>

<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

<title>SuperCollider API</title>

</head>

<body>

<div class="container">


<div class="navbar navbar-inverse">
  <div class="navbar-inner">
    <a class="brand" href="#">SuperCollider API</a>
    <ul class="nav">
    	<li><span class="label" id="connection_status">connection status</span></li>
    </ul>
  </div>
</div>


<div class="row-fluid">
	<div class="span8 well">

		<form class="form form-horizontal" id="callform">
			<div class="control-group">
				<label class="control-label">path</label>
				<div class="controls"><input type="text" name="path" id="path" value="" /></div>
			</div>
			<div class="control-group">
				<label class="control-label">args</label>
				<div class="controls"><textarea name="args" id="args" />[]</textarea></div>
			</div>
			<div class="controls"><input type="submit" value="call" class="btn btn-primary" id="submit" /></div>
		</form>

		<div id="response_time"></div>
		<div id="response" class="info"></div>

	</div>
	<div class="span4" id="api_list">
		<h4>paths</h4>
		<ul class="nav nav-list">
		</ul>
	</div>
</div>

</div>


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.2/underscore-min.js"></script>


<!--
	this seems to be a different version than what npm delivers
	npm is 0.9.11
	cdn is 0.6
<script src="http://cdn.socket.io/stable/socket.io.js"></script>
<script type="text/javascript">
	WEB_SOCKET_SWF_LOCATION = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//cdn.socket.io/' + this.io.version + '/WebSocketMain.swf';
</script>
-->
<script src="/socket.io/socket.io.js"></script>

<script src="/media/js/scapi.js"></script>


<script type='text/javascript'>

	var sc = new SCApi("localhost", 4040);

	function timestamp() {
		var now = new Date();
		$("#response_time").html(now.toTimeString());
	}
	$("#callform").submit(function(e) {
		var path = $("input[name=path]", this).val(),
			args = $("input[name=args]", this).val();
		e.preventDefault();
		if(args) {
			args = eval(args); // evil
		}
		sc.call(path, args,
			function(data) {
				$("#response").html(data).attr('class','alert alert-success');
				timestamp();
			},
			function(data) {
				timestamp();
				$("#response").html(data).attr('class','alert alert-error');
			}
		);
	});

	// fetch api paths and populate the sidebar
	sc.call("API.paths", [], function(paths) {
		var ul = $("#api_list ul");
		_.each(paths, function(path) {
			ul.append("<li><a>" + path + "</a></li>");
		});
		$("li a",ul).click(function() {
			$("#callform #path").val($(this).html());
		});
	});
</script>
</body>

</html>
